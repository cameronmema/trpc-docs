---
title: Express Adapter
description: Integrate tRPC with Express.js for traditional REST API architectures
icon: IconServer
---

The Express adapter allows you to add tRPC to existing Express.js applications or create new Express servers with tRPC endpoints. It's perfect for traditional server architectures and microservices.

<Callout title="Express Integration">
  The Express adapter is ideal for adding tRPC to existing Express applications
  or when you need the full flexibility of Express middleware and routing.
</Callout>

## Example Apps

<Cards>
  <Card
    href="https://github.com/trpc/trpc/tree/main/examples/express-server"
    title="Express Server Example"
  >
    Complete Express server with tRPC integration and Node.js client
  </Card>
  <Card
    href="https://githubbox.com/trpc/trpc/tree/main/examples/express-server"
    title="CodeSandbox Demo"
  >
    Try the Express server example in your browser
  </Card>
</Cards>

## Installation

Install the required dependencies:

<Tabs items={['npm', 'pnpm', 'yarn', 'bun']}>
  <Tab value="npm">
    ```bash npm install @trpc/server express zod npm install -D @types/express
    @types/node typescript ```
  </Tab>
  <Tab value="pnpm">
    ```bash pnpm add @trpc/server express zod pnpm add -D @types/express
    @types/node typescript ```
  </Tab>
  <Tab value="yarn">
    ```bash yarn add @trpc/server express zod yarn add -D @types/express
    @types/node typescript ```
  </Tab>
  <Tab value="bun">
    ```bash bun add @trpc/server express zod bun add -D @types/express
    @types/node typescript ```
  </Tab>
</Tabs>

<Callout title="Optional: Validation Library" type="info">
  Zod isn't required but is recommended for input validation. Install with your
  preferred package manager.
</Callout>

## Quick Start

### 1. Create your tRPC router

First, define your API procedures:

```typescript title="server/router.ts"
import { initTRPC } from '@trpc/server';
import { z } from 'zod';

export const t = initTRPC.create();

export const appRouter = t.router({
  getUser: t.procedure
    .input(z.string())
    .query(({ input }) => {
      // input is typed as string
      return { id: input, name: 'Bilbo' };
    }),

  createUser: t.procedure
    .input(z.object({
      name: z.string().min(5),
      email: z.string().email()
    }))
    .mutation(async ({ input }) => {
      // Use your ORM of choice
      return await UserModel.create({
        data: input,
      });
    }),
});

// Export type definition of API
export type AppRouter = typeof appRouter;
```

### 2. Create context (optional)

```typescript title="server/context.ts"
import type { CreateExpressContextOptions } from '@trpc/server/adapters/express';

// Create context for each request
export const createContext = ({
  req,
  res
}: CreateExpressContextOptions) => {
  // Add anything you want to be available in all procedures
  return {
    req,
    res,
    // Add database, user session, etc.
  };
};

export type Context = Awaited<ReturnType<typeof createContext>>;
```

### 3. Set up Express server with tRPC

```typescript title="server.ts"
import express from 'express';
import { createExpressMiddleware } from '@trpc/server/adapters/express';
import { appRouter } from './router';
import { createContext } from './context';

const app = express();

// Add tRPC middleware
app.use(
  '/trpc',
  createExpressMiddleware({
    router: appRouter,
    createContext,
  }),
);

// Regular Express routes can coexist
app.get('/health', (req, res) => {
  res.json({ status: 'ok' });
});

const port = process.env.PORT || 4000;
app.listen(port, () => {
  console.log(`Server running on http://localhost:${port}`);
});
```

## API Endpoints

Once your server is running, your tRPC procedures are available as HTTP endpoints:

| Procedure    | HTTP Method | Endpoint                    | Description                              |
| ------------ | ----------- | --------------------------- | ---------------------------------------- |
| `getUser`    | GET         | `/trpc/getUser?input=INPUT` | Where INPUT is a URI-encoded JSON string |
| `createUser` | POST        | `/trpc/createUser`          | With JSON body containing the input data |

### Example requests

<Tabs items={['Query Example', 'Mutation Example']}>
  <Tab value="Query Example">
    ```bash
    # GET request for queries
    curl "http://localhost:4000/trpc/getUser?input=\"user_123\""
    ```
    
    Response:
    ```json
    {
      "result": {
        "data": {
          "id": "user_123",
          "name": "Bilbo"
        }
      }
    }
    ```
  </Tab>
  <Tab value="Mutation Example">
    ```bash
    # POST request for mutations
    curl -X POST http://localhost:4000/trpc/createUser \
      -H "Content-Type: application/json" \
      -d '{"name": "Frodo Baggins", "email": "frodo@shire.com"}'
    ```
    
    Response:
    ```json
    {
      "result": {
        "data": {
          "id": "generated_id",
          "name": "Frodo Baggins",
          "email": "frodo@shire.com"
        }
      }
    }
    ```
  </Tab>
</Tabs>

## Advanced Configuration

### CORS Support

Enable CORS for cross-origin requests:

```typescript title="server.ts"
import cors from 'cors';

const app = express();

// Configure CORS
app.use(cors({
  origin: process.env.NODE_ENV === 'production'
    ? ['https://yourdomain.com']
    : ['http://localhost:3000'],
  credentials: true,
}));

app.use('/trpc', createExpressMiddleware({
  router: appRouter,
  createContext,
}));
```

### Error Handling

Add global error handling:

```typescript title="server.ts"
app.use('/trpc', createExpressMiddleware({
  router: appRouter,
  createContext,
  onError: ({ error, path, input, ctx, type, req }) => {
    console.error(`Error in ${type} procedure on path '${path}':`, error);

    // Send errors to monitoring service
    if (error.code === 'INTERNAL_SERVER_ERROR') {
      errorMonitoring.captureException(error, {
        extra: { path, input, type },
        user: ctx?.user,
      });
    }
  },
}));
```

### Custom Middleware

Add Express middleware before tRPC:

```typescript title="server.ts"
import helmet from 'helmet';
import rateLimit from 'express-rate-limit';

const app = express();

// Security middleware
app.use(helmet());

// Rate limiting
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // limit each IP to 100 requests per windowMs
});
app.use('/trpc', limiter);

// tRPC middleware
app.use('/trpc', createExpressMiddleware({
  router: appRouter,
  createContext,
}));
```

### File Upload Support

Handle file uploads with tRPC:

```typescript title="router.ts"
import multer from 'multer';

const upload = multer({ dest: 'uploads/' });

// In your Express app
app.post('/upload', upload.single('file'), (req, res) => {
  // Handle file upload, then call tRPC procedure if needed
  res.json({ success: true, filename: req.file?.filename });
});
```

## Integration Patterns

### With Existing Express Apps

Add tRPC to an existing Express application:

```typescript title="existing-server.ts"
import express from 'express';
import { createExpressMiddleware } from '@trpc/server/adapters/express';
import { appRouter } from './trpc/router';

const app = express();

// Existing Express routes
app.get('/api/health', (req, res) => {
  res.json({ status: 'ok' });
});

app.use('/api/users', userRoutes);
app.use('/api/posts', postRoutes);

// Add tRPC under a specific path
app.use('/api/trpc', createExpressMiddleware({
  router: appRouter,
  createContext: ({ req, res }) => ({ req, res }),
}));
```

### Organizing Large Routers

Split your router into multiple files for better organization:

```typescript title="routers/_app.ts"
import { t } from '../trpc';
import { userRouter } from './users';
import { postRouter } from './posts';
import { authRouter } from './auth';

export const appRouter = t.router({
  users: userRouter,
  posts: postRouter,
  auth: authRouter,
});

export type AppRouter = typeof appRouter;
```

## Testing

Test your tRPC procedures with Express:

```typescript title="server.test.ts"
import request from 'supertest';
import express from 'express';
import { createExpressMiddleware } from '@trpc/server/adapters/express';
import { appRouter } from './router';

const createTestApp = () => {
  const app = express();
  app.use('/trpc', createExpressMiddleware({
    router: appRouter,
    createContext: () => ({}),
  }));
  return app;
};

describe('tRPC Express Adapter', () => {
  const app = createTestApp();

  it('should handle queries', async () => {
    const response = await request(app)
      .get('/trpc/getUser?input="user_123"')
      .expect(200);

    expect(response.body.result.data).toEqual({
      id: 'user_123',
      name: 'Bilbo'
    });
  });

  it('should handle mutations', async () => {
    const response = await request(app)
      .post('/trpc/createUser')
      .send({ name: 'Test User', email: 'test@example.com' })
      .expect(200);

    expect(response.body.result.data.name).toBe('Test User');
  });
});
```

## Deployment

### Production Considerations

<Accordions>
  <Accordion title="Environment Variables">
    Set up proper environment configuration:
    
    ```typescript title="config.ts"
    export const config = {
      port: parseInt(process.env.PORT || '4000'),
      nodeEnv: process.env.NODE_ENV || 'development',
      databaseUrl: process.env.DATABASE_URL,
      jwtSecret: process.env.JWT_SECRET,
    };
    ```
  </Accordion>
  
  <Accordion title="Process Management">
    Use PM2 or similar for production deployment:
    
    ```json title="ecosystem.config.js"
    module.exports = {
      apps: [{
        name: 'trpc-express-server',
        script: './dist/server.js',
        instances: 'max',
        exec_mode: 'cluster',
        env: {
          NODE_ENV: 'production',
          PORT: 4000
        }
      }]
    };
    ```
  </Accordion>
  
  <Accordion title="Health Checks">
    Add health check endpoints for monitoring:
    
    ```typescript
    app.get('/health', (req, res) => {
      res.json({ 
        status: 'ok', 
        timestamp: new Date().toISOString(),
        uptime: process.uptime()
      });
    });
    ```
  </Accordion>
</Accordions>

## Next Steps

<Cards>
  <Card href="/docs/server/procedures" title="Define Procedures">
    Learn how to create queries, mutations, and subscriptions
  </Card>
  <Card href="/docs/server/context" title="Add Context">
    Share data like database connections and user sessions
  </Card>
  <Card href="/docs/server/middlewares" title="Add Middleware">
    Implement authentication, logging, and custom logic
  </Card>
  <Card href="/docs/client" title="Connect Your Frontend">
    Integrate tRPC with your React, Next.js, or other frontend
  </Card>
</Cards>
